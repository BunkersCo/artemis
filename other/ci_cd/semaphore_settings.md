# Setup
1. ```if [ "$BRANCH_NAME" != "master" ]; then gem install octokit -v 4.0.0 --no-ri --no-rdoc && export PULL_REQUEST_NUMBER=$(ruby pull_request_number.rb); fi```
2. ```python -m pip install pre-commit && pre-commit install && pre-commit run --all-files```
3. ```export GIT_BRANCH=$BRANCH_NAME && export GIT_ID=$REVISION && export GIT_AUTHOR_NAME=$(git --no-pager log -1 --pretty=format:%aN) && export GIT_AUTHOR_EMAIL=$(git --no-pager log -1 --pretty=format:%ae) && export GIT_COMMITTER_NAME=$(git --no-pager log -1 --pretty=format:%cN) && export GIT_COMMITTER_EMAIL=$(git --no-pager log -1 --pretty=format:%ce) && export GIT_MESSAGE=$(git --no-pager log -1 --pretty=format:%s) && export GIT_REMOTE=$(git remote -v | grep "(fetch)" | cut -f1) && export GIT_URL=$(git remote -v | grep "(fetch)" | cut -f2 | cut -d" " -f1)```
4. ```if [[ "$(git diff HEAD~1 -X backend/ | wc -l)" -ne "0" || "$(git diff master -X backend/ | wc -l)" -ne "0" ]]; then docker build -t artemis_backend:latest ./backend; else docker pull inspiregroup/artemis-backend:latest; docker tag inspiregroup/artemis-backend:latest artemis_backend:latest; echo "No changes on Backend. Skipping building..."; fi```
5. ```if [[ "$(git diff HEAD~1 -X frontend/ | wc -l)" -ne "0" || "$(git diff master -X frontend/ | wc -l)" -ne "0" ]]; then docker build -t artemis_frontend:latest ./frontend; else docker pull inspiregroup/artemis-frontend:latest; docker tag inspiregroup/artemis-frontend:latest artemis_frontend:latest; echo "No changes on Frontend. Skipping building..."; fi```
6. ```if [ -d "monitor" ]; then if [[ "$(git diff HEAD~1 -X monitor/ | wc -l)" -ne "0" || "$(git diff master -X monitor/ | wc -l)" -ne "0" ]]; then docker build -t artemis_monitor:latest ./monitor; else docker pull inspiregroup/artemis-monitor:latest; docker tag inspiregroup/artemis-monitor:latest artemis_monitor:latest; echo "No changes on Monitor. Skipping building..."; fi; fi```

# Tests
1. ```if [[ "$(git diff HEAD~1 -X backend/ | wc -l)" -ne "0" || "$(git diff master -X backend/ | wc -l)" -ne "0" ]]; then sed -i 's/coveralls_token_here/'$COVERALLS_REPO_TOKEN'/g' backend/docker-compose.test-backend.yml; docker-compose -f backend/docker-compose.test-backend.yml up --abort-on-container-exit; else echo "No changes on Backend. Skipping testing.."; fi```
2. ```if [[ "$(git diff HEAD~1 -X backend/ | wc -l)" -ne "0" || "$(git diff master -X backend/ | wc -l)" -ne "0" ]]; then docker-compose -f backend/docker-compose.test-backend.yml down; else echo "No changes on Backend. Skipped testing."; fi```
3. ```if [ -d "testcafe" ]; then if [[ "$(git diff HEAD~1 -X backend/ frontend/ testcafe/ | wc -l)" -ne "0" || "$(git diff master -X backend/ frontend/ testcafe/ | wc -l)" -ne "0" ]]; then docker-compose -f docker-compose.testcafe.yaml up --abort-on-container-exit; else echo "No changes on Backend/Frontend/Testcafe. Skipping testing.."; fi; fi```
4. ```if [ -d "testcafe" ]; then if [[ "$(git diff HEAD~1 -X backend/ frontend/ testcafe/ | wc -l)" -ne "0" || "$(git diff master -X backend/ frontend/ testcafe/ | wc -l)" -ne "0" ]]; then docker-compose -f docker-compose.testcafe.yaml down; else echo "No changes on Backend/Frontend/Testcafe. Skipped testing.."; fi; fi```
5. ```if [[ -d "benchmark" && ! -z "$PULL_REQUEST_NUMBER" ]]; then if [[ "$(git diff HEAD~1 -X backend/ benchmark/ | wc -l)" -ne "0" || "$(git diff master -X backend/ benchmark/ | wc -l)" -ne "0" ]]; then docker-compose -f docker-compose.benchmark.yaml up --abort-on-container-exit; else echo "No changes on Backend/Benchmark. Skipping testing.."; fi; fi```
6. ```if [[ -d "benchmark" && ! -z "$PULL_REQUEST_NUMBER" ]]; then if [[ "$(git diff HEAD~1 -X backend/ benchmark/ | wc -l)" -ne "0" || "$(git diff master -X backend/ benchmark/ | wc -l)" -ne "0" ]]; then docker-compose -f docker-compose.benchmark.yaml down; else echo "No changes on Backend/Benchmark. Skipped testing.."; fi; fi```
7. ```if [ -d "autoconf-tester" ]; then if [[ "$(git diff HEAD~1 -X backend/ autoconf-tester/ | wc -l)" -ne "0" || "$(git diff master -X backend/ autoconf-tester/ | wc -l)" -ne "0" ]]; then docker-compose -f docker-compose.autoconftester.yaml up --abort-on-container-exit; else echo "No changes on Backend/Autoconf Tester. Skipping testing.."; fi; fi```
8. ```if [ -d "autoconf-tester" ]; then if [[ "$(git diff HEAD~1 -X backend/ autoconf-tester/ | wc -l)" -ne "0" || "$(git diff master -X backend/ autoconf-tester/ | wc -l)" -ne "0" ]]; then docker-compose -f docker-compose.autoconftester.yaml down; else echo "No changes on Backend/Autoconf Tester. Skipped testing.."; fi; fi```

# After job
1. ```if [ "$BRANCH_NAME" != "master" ]; then sed -i 's/SYSTEM_VERSION=.*/SYSTEM_VERSION='$BRANCH_NAME'/g' .env; tag=dev-"$BRANCH_NAME"; else tag="latest"; fi && if [ "$SEMAPHORE_JOB_RESULT" == "passed" ]; then docker tag artemis_backend:latest inspiregroup/artemis-backend:$tag; docker push inspiregroup/artemis-backend:$tag; docker tag artemis_frontend:latest inspiregroup/artemis-frontend:$tag; docker push inspiregroup/artemis-frontend:$tag; if [ -d "monitor" ]; then docker tag artemis_monitor:latest inspiregroup/artemis-monitor:$tag; docker push inspiregroup/artemis-monitor:$tag; fi; fi```
